version: '3.9'

services:
  # ===== Conta Service =====
  conta-service:
    build:
      context: ../conta-service
      dockerfile: Dockerfile
    image: conta-service:latest
    container_name: conta-service
    ports:
      - "8081:8080"  # Mapeando porta do container para host
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SPRING_DATASOURCE_URL: ${DB_URL}
      SPRING_DATASOURCE_USERNAME: ${DB_USER}
      SPRING_DATASOURCE_PASSWORD: ${DB_PASS}
    networks:
      - microservices-net
    depends_on:
      - kafka-service  # Garantir que Kafka suba primeiro

  # ===== Kafka Service =====
  kafka-service:
    build:
      context: ../kafka-service
      dockerfile: Dockerfile
    image: kafka-service:latest
    container_name: kafka-service
    ports:
      - "8082:8080"
    environment:
      SPRING_PROFILES_ACTIVE: dev
    networks:
      - microservices-net

# ===== Network compartilhada entre os microservi√ßos =====
networks:
  microservices-net:
    driver: bridge
