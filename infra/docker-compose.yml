version: '3.9'

services:
  # ==============================
  # Serviço de Conta
  # ==============================
  conta-service:
    build:
      context: ..
      dockerfile: infra/Dockerfile  # Dockerfile único na pasta infra
      args:
        MODULE: conta-service       # Passa o módulo a ser construído
    container_name: conta-service
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: dev
    depends_on:
      - kafka-service

  # ==============================
  # Serviço Kafka
  # ==============================
  kafka-service:
    build:
      context: ..
      dockerfile: infra/Dockerfile
      args:
        MODULE: kafka-service
    container_name: kafka-service
    ports:
      - "9092:9092"
    environment:
      SPRING_PROFILES_ACTIVE: dev
    depends_on:
      - generico-service

  # ==============================
  # Serviço Genérico (Commons / Lib)
  # ==============================
  generico-service:
    build:
      context: ..
      dockerfile: infra/Dockerfile
      args:
        MODULE: generico-service
    container_name: generico-service
    ports:
      - "8070:8070"
    environment:
      SPRING_PROFILES_ACTIVE: dev