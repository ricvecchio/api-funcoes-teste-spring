# ======================================
# ðŸ”¹ Imagem base com JDK 21 (Eclipse Temurin)
# ======================================
FROM eclipse-temurin:21-jre-jammy

# ======================================
# ðŸ”¹ DiretÃ³rio de trabalho dentro do container
# ======================================
WORKDIR /app

# ======================================
# ðŸ”¹ InstalaÃ§Ã£o de utilitÃ¡rios necessÃ¡rios para healthcheck e debugging
# curl: usado pelo HEALTHCHECK
# ======================================
RUN apt-get update && \
    apt-get install -y curl && \
    rm -rf /var/lib/apt/lists/*

# ======================================
# ðŸ”¹ Copia o JAR gerado pelo Maven para o container
# Usa pattern matching para pegar o JAR na pasta target
# ======================================
COPY target/*.jar app.jar

# ======================================
# ðŸ”¹ ExposiÃ§Ã£o da porta interna da aplicaÃ§Ã£o (Spring Boot)
# Deve corresponder ao server.port do application.properties
# ======================================
EXPOSE 8080

# ======================================
# ðŸ”¹ Healthcheck para Docker
# Verifica se o endpoint /actuator/health retorna sucesso
# Intervalo: 20s, Timeout: 10s, Start-period: 60s, Tentativas: 5
# ======================================
HEALTHCHECK --interval=20s --timeout=10s --start-period=60s --retries=5 \
    CMD curl -f http://localhost:8080/actuator/health || exit 1

# ======================================
# ðŸ”¹ Comando de inicializaÃ§Ã£o da aplicaÃ§Ã£o
# ======================================
ENTRYPOINT ["java", "-jar", "app.jar"]
