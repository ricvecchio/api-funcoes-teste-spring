# ======================================
# ðŸ”¹ Imagem base com JDK 21
# ======================================
FROM eclipse-temurin:21-jre-jammy

# ======================================
# ðŸ”¹ DiretÃ³rio de trabalho
# ======================================
WORKDIR /app

# ======================================
# ðŸ”¹ Instala utilitÃ¡rios necessÃ¡rios
# curl: usado para healthcheck
# ======================================
RUN apt-get update && \
    apt-get install -y curl && \
    rm -rf /var/lib/apt/lists/*

# ======================================
# ðŸ”¹ Copia JAR gerado pelo Maven
# ======================================
COPY target/*.jar app.jar

# ======================================
# ðŸ”¹ Porta interna do container
# ======================================
EXPOSE 8080

# ======================================
# ðŸ”¹ Healthcheck usando endpoint do Spring Boot
# ======================================
HEALTHCHECK --interval=20s --timeout=10s --start-period=60s --retries=5 \
    CMD curl -f http://localhost:8080/actuator/health || exit 1

# ======================================
# ðŸ”¹ Comando de inicializaÃ§Ã£o
# ======================================
ENTRYPOINT ["java", "-jar", "app.jar"]